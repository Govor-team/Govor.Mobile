<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.Buttons;assembly=Syncfusion.Maui.Toolkit"
             x:Class="Govor.Mobile.Pages.MainFlow.SettingsPage"
             xmlns:sharp="http://sharpnado.com"
             Title="Настройки"
             BackgroundColor="#282A37"
             BackgroundImageSource="{AppThemeBinding Dark=background_girls.png, Light=background_flag.png}" 
             Padding="{OnPlatform iOS='0,30,0,0', Android='0'}">
    <ScrollView Padding="16">
        <VerticalStackLayout Spacing="20" Grid.Column="1">
            <!-- Аватар + имя -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="8">
                <Grid>
                    <Image Source="default_avatar.png"
                               Aspect="AspectFill"
                               WidthRequest="120"
                               HeightRequest="120"
                               HorizontalOptions="Fill"
                               VerticalOptions="Fill"/>

                    <!-- Иконка камеры -->
                    <Border StrokeShape="RoundRectangle 30"
                                Background="#43A25A"
                                StrokeThickness="1"
                                Stroke="#3F3F3F"
                                WidthRequest="45"
                                HeightRequest="45"
                                HorizontalOptions="End"
                                VerticalOptions="End"
                                TranslationX="10"
                                TranslationY="0">
                        <Image Source="camera_icon.png"
                                   WidthRequest="30"
                                   HeightRequest="30"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                    </Border>
                </Grid>

                <Label Text="{Binding UserName}"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center">
                    <Label.Shadow>
                        <Shadow Brush="Black"
                                Offset="1,3"
                                Radius="2"
                                Opacity="0.6" />
                    </Label.Shadow>
                </Label>
            </VerticalStackLayout>

            <!-- О себе -->
            <Border Background="#30FFFFFF"
                        Stroke="#33FFFFFF"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 20"
                        Padding="10"
                        Margin="0,0,0,10">
                <Editor Text="{Binding About}"
                        Placeholder="О себе"
                        AutoSize="TextChanges"
                        TextColor="White"
                        PlaceholderColor="#FFFFFF"
                        BackgroundColor="Transparent"
                        FontSize="17"
                        HeightRequest="120"
                        Margin="0,0,0,0" />
            </Border>

            <!-- Активные сессии -->
            <Label Text="Активные сессии"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="White"
                       Margin="0,10,0,0"/>

            <CollectionView ItemsSource="{Binding Sessions}"
                    SelectionMode="None"
                    Margin="0,5,0,0">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"
                           ItemSpacing="10" />
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border     Background="#30FFFFFF"
                                    Stroke="#40FFFFFF"
                                    StrokeShape="RoundRectangle 20"
                                    Padding="10"
                                    Margin="0,5,0,0">
                            <Grid ColumnDefinitions="Auto,*,Auto"
                                      ColumnSpacing="10"
                                      VerticalOptions="Center">

                                <!-- Иконка устройства -->
                                <Image Source="{Binding Icon}"
                                           WidthRequest="50"
                                           HeightRequest="50"
                                           VerticalOptions="Center"/>

                                <!-- Информация -->
                                <VerticalStackLayout Grid.Column="1"
                                                         Spacing="2"
                                                         VerticalOptions="Center">
                                    <Label Text="{Binding DeviceName}"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   FontSize="16"/>
                                    <Label Text="{Binding CreatedAt, StringFormat='Была открыта {0:yyyy.MM.dd}'}"
                                                   TextColor="White"
                                                   FontSize="13"
                                                   Opacity="0.8"/>
                                </VerticalStackLayout>

                                <!-- Кнопка закрытия -->
                                <sf:SfButton Grid.Column="2"
                                             WidthRequest="28" 
                                             HeightRequest="28"
                                             CornerRadius="10"
                                             Background="#00FFFFFF"
                                             ImageSource="close_icon.png"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             EnableRippleEffect="True"
                                             ImageAlignment="Bottom"
                                             ShowIcon="True" 
                                             Clicked="OnRemoveSessionClicked"
                                             CommandParameter="{Binding .}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>