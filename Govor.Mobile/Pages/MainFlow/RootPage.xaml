<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sho="http://sharpnado.com"
             xmlns:tabsLayout="clr-namespace:Govor.Mobile.Pages.MainFlow.Layouts"
             x:Class="Govor.Mobile.Pages.MainFlow.RootPage"
             SafeAreaEdges="None"
             BackgroundColor="#282A37"
             Padding="0"
             ControlTemplate="{StaticResource MainPageTemplate}">
    <Grid SafeAreaEdges="None"
          Padding="0,10,0,0"
          BackgroundColor="Transparent">

        <!-- ОСНОВНОЙ КОНТЕНТ -->
        <sho:ViewSwitcher
            x:Name="Switcher"
            Animate="True"
            SelectedIndex="{Binding SelectedViewModelIndex, Mode=OneWay}">

            <tabsLayout:HomeView BindingContext="{Binding HomePageViewModel}" />
            <tabsLayout:FriendsView BindingContext="{Binding FriendsPageViewModel}" />
        </sho:ViewSwitcher>

        <!--      
        <contentViews:FloatingBottomBarView 
            SelectedIndex="{Binding SelectedViewModelIndex, Mode=TwoWay}"
            TabCommand="{Binding ChangeTabCommand}"
            ZIndex="10" />
           -->

        <Grid VerticalOptions="End"
              HorizontalOptions="Fill"
              Margin="16,0,16,16"
              ZIndex="10"
              RowDefinitions="Auto, Auto">
            <VerticalStackLayout Spacing="10" Grid.Row="0">

                <Border Background="Transparent"
                        StrokeThickness="0"
                        IsVisible="{Binding HasNewUpdate}"
                        HorizontalOptions="Center">

                    <Border.Shadow>
                        <Shadow Brush="Black" Offset="0,4" Radius="8" Opacity="0.3" />
                    </Border.Shadow>

                    <sho:MaterialFrame
                        MaterialTheme="AcrylicBlur"
                        MaterialBlurStyle="Dark"
                        AndroidBlurRadius="15"
                        CornerRadius="20"
                        Padding="16,8"
                        VerticalOptions="Center">

                    <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                        <Image Source="download_icon.png"
                               HeightRequest="22"
                               WidthRequest="22"
                               VerticalOptions="Center">
                        </Image>

                        <Label Text="Доступна новая версия"
                               TextColor="White"
                               FontSize="16"
                               FontAttributes="Bold"
                               VerticalOptions="Center" />

                        <Button Text="Скачать"
                                FontSize="18"
                                FontFamily="CirilicOld"
                                FontAttributes="Bold"
                                TextColor="White" 
                                BackgroundColor="#00CC42"
                                CornerRadius="12"
                                HeightRequest="32"
                                Padding="15,0"
                                Command="{Binding DownloadUpdateCommand}" />
                    </HorizontalStackLayout>
                    </sho:MaterialFrame>
                </Border>
                
                <Border StrokeThickness="0"
                        Background="#AA282A37"
                        StrokeShape="RoundRectangle 20"
                        HeightRequest="60">

                    <sho:TabHostView
                        TabType="Fixed"
                        IsSegmented="True"
                        CornerRadius="40"
                        BackgroundColor="Transparent"
                        VerticalOptions="Center"
                        HorizontalOptions="Fill"
                        TouchColor="{StaticResource Primary}"
                        SelectedIndex="{Binding SelectedViewModelIndex, Mode=TwoWay}">

                        <sho:TabHostView.Tabs>
                            <sho:BottomTabItem IconSize="34" IconImageSource="chat_icon.png" />
                            <sho:BottomTabItem IconSize="34" IconImageSource="friends_icon.png" />
                            <sho:BottomTabItem IconSize="34" IconImageSource="call_icon.png" />
                        </sho:TabHostView.Tabs>
                    </sho:TabHostView>
                </Border>

            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>