<?xml version="1.0" encoding="utf-8"?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                            xmlns:buttons="clr-namespace:Syncfusion.Maui.Toolkit.Buttons;assembly=Syncfusion.Maui.Toolkit"
                            xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
                            xmlns:contentViews="clr-namespace:Govor.Mobile.Pages.ContentViews"
                            xmlns:better="clr-namespace:BetterUIKit.TabView;assembly=BetterUIKit"
                            xmlns:sho="http://sharpnado.com"
                            xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                            xmlns:viewModels="clr-namespace:Govor.Mobile.PageModels.ContentViewsModel"
                            x:Class="Govor.Mobile.Pages.MainFlow.FriendsSearchPage"
                            SafeAreaEdges="None"
                            x:Name="RootControl"
                            BackgroundColor="#282A37"
                            Padding="0"
                            ControlTemplate="{StaticResource MainPageTemplate}">

    <Grid SafeAreaEdges="None"
          RowDefinitions="Auto, Auto, *" Padding="16,0,16,10" RowSpacing="15">

        <Grid Grid.Row="2">
            <better:BetterTabView
                x:Name="BetterTabView"
                TabBarHeight="35"
                EnableSwiping="True"
                Margin="0,0,0,10">
                <better:BetterTabView.TabItems>
                    <!-- Ð’Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð·Ð°ÑÐ²ÐºÐ¸ -->
                    <better:BetterTabItem Header="Ð’Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ">
                        <CollectionView
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding BindingContext.OpenIncomingProfileCommand, Source={x:Reference RootControl}}"
                            SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                            VerticalScrollBarVisibility="Never"
                            ItemsSource="{Binding BindingContext.IncomingRequests, Source={x:Reference RootControl}}"
                            SelectionChanged="OnSelectionChanged"
                            Margin="0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewModels:UserListItemViewModel">
                                    <contentViews:UserItemView />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>

                            <CollectionView.EmptyView>
                                <VerticalStackLayout
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center"
                                    Spacing="10"
                                    Padding="30">
                                    <Label Text="ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÑÐ²Ð¾Ðº"
                                           TextColor="#80FFFFFF"
                                           HorizontalTextAlignment="Center" />
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </better:BetterTabItem>

                    <!-- ÐžÐ¶Ð¸Ð´Ð°ÐµÐ½Ð¸Ðµ -->
                    <better:BetterTabItem Header="ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ">
                        <CollectionView
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding BindingContext.OpenOutgoingProfileCommand, Source={x:Reference RootControl}}"
                            SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                            VerticalScrollBarVisibility="Never"
                            ItemsSource="{Binding BindingContext.OutgoingRequests, Source={x:Reference RootControl}}"
                            SelectionChanged="OnSelectionChanged"
                            Margin="0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="viewModels:UserListItemViewModel">
                                    <contentViews:UserItemView />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>

                            <CollectionView.EmptyView>
                                <VerticalStackLayout
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center"
                                    Spacing="10"
                                    Padding="30">
                                    <Label Text="ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÑÐ²Ð¾Ðº"
                                           TextColor="#80FFFFFF"
                                           HorizontalTextAlignment="Center" />
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </better:BetterTabItem>

                    <!-- ÐŸÐ¾Ð¸ÑÐº -->
                    <better:BetterTabItem Header="ÐŸÐ¾Ð¸ÑÐº">
                        <Grid RowDefinitions="Auto, *" Padding="0,0,0,0">

                            <Border Grid.Row="0"
                                    StrokeThickness="1"
                                    Background="#20ffffff"
                                    Margin="0,5">
                                <sho:MaterialFrame
                                    MaterialTheme="AcrylicBlur"
                                    MaterialBlurStyle="Dark"
                                    Elevation="0"
                                    AndroidBlurRadius="40"
                                    CornerRadius="20"
                                    Padding="12,0"
                                    HeightRequest="60">

                                    <Grid ColumnDefinitions="Auto, *, Auto, Auto" ColumnSpacing="5">

                                        <Label Grid.Column="0"
                                               Text="ðŸ”"
                                               VerticalOptions="Center"
                                               FontSize="18"
                                               Margin="5,0,5,0"
                                               Opacity="0.7" />

                                        <Entry Grid.Column="1"
                                               x:Name="FriendSearchEntry"
                                               Placeholder="ÐÐ¸ÐºÐ½ÐµÐ¹Ð¼ Ð¸Ð»Ð¸ ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ..."
                                               PlaceholderColor="#80FFFFFF"
                                               TextColor="White"
                                               FontFamily="Bold"
                                               Text="{Binding BindingContext.SearchText, Source={x:Reference RootControl}}"
                                               FontSize="17"                                        
                                               VerticalOptions="Center"
                                               BackgroundColor="Transparent">
                                            <Entry.Behaviors>
                                                <toolkit:UserStoppedTypingBehavior 
                                                        Command="{Binding BindingContext.SearchFriendsCommand, Source={x:Reference RootControl}}"
                                                        MinimumLengthThreshold="0"
                                                        StoppedTypingTimeThreshold="500"
                                                       />
                                            </Entry.Behaviors>
                                        </Entry>


                                        <ImageButton Grid.Column="2"
                                                     x:Name="ScanQrButton"
                                                     Source="scan_icon.png"
                                                     WidthRequest="50"
                                                     HeightRequest="50"
                                                     Padding="8"
                                                     VerticalOptions="Center"
                                                     BackgroundColor="Transparent"
                                                     Aspect="AspectFit">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal" />
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="Opacity" Value="0.5" />
                                                                <Setter Property="Scale" Value="0.9" />
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </ImageButton>

                                        <ImageButton Grid.Column="3"
                                                     x:Name="GenerateQrButton"
                                                     Source="qr_icon.png"
                                                     WidthRequest="40"
                                                     HeightRequest="40"
                                                     Padding="8"
                                                     VerticalOptions="Center"
                                                     BackgroundColor="Transparent"
                                                     Aspect="AspectFit">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroupList>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal" />
                                                        <VisualState x:Name="Pressed">
                                                            <VisualState.Setters>
                                                                <Setter Property="Opacity" Value="0.5" />
                                                                <Setter Property="Scale" Value="0.9" />
                                                            </VisualState.Setters>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateGroupList>
                                            </VisualStateManager.VisualStateGroups>
                                        </ImageButton>

                                    </Grid>
                                </sho:MaterialFrame>
                            </Border>
                            
                            <CollectionView Grid.Row="1"
                                            ItemsSource="{Binding BindingContext.SearchResults, Source={x:Reference RootControl}}"
                                            Margin="0"
                                            SelectionMode="Single"
                                            SelectionChangedCommand="{Binding BindingContext.OpenProfileCommand, Source={x:Reference RootControl}}"
                                            SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                                            VerticalScrollBarVisibility="Never"
                                            SelectionChanged="OnSelectionChanged">

                                <CollectionView.Header>
                                    <Label Text="Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ñ‹ Ð·Ð½Ð°ÐºÐ¾Ð¼Ñ‹"
                                           TextColor="#B0FFFFFF"
                                           FontSize="13"
                                           Margin="5,0,0,10" />
                                </CollectionView.Header>

                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:UserListItemViewModel">
                                        <contentViews:UserItemView />
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>

                                <CollectionView.EmptyView>
                                    <VerticalStackLayout HorizontalOptions="Center"
                                                         VerticalOptions="Center"
                                                         Margin="0,60">

                                        <Label Text="ðŸ”Ž" FontSize="50" HorizontalOptions="Center" />
                                        <Label Text="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð´Ñ€ÑƒÐ³Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº"
                                               TextColor="#60FFFFFF"
                                               HorizontalTextAlignment="Center"
                                               Margin="0,10" />
                                    </VerticalStackLayout>
                                </CollectionView.EmptyView>
                            </CollectionView>
                        </Grid>
                    </better:BetterTabItem>
                </better:BetterTabView.TabItems>
            </better:BetterTabView>
        </Grid>
    </Grid>
</uranium:UraniumContentPage>