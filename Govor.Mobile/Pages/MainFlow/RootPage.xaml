<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sho="http://sharpnado.com"
             xmlns:tabsLayout="clr-namespace:Govor.Mobile.Pages.MainFlow.Layouts"
             x:Class="Govor.Mobile.Pages.MainFlow.RootPage"
             SafeAreaEdges="None"
             BackgroundColor="#282A37"
             Padding="0"
             ControlTemplate="{StaticResource MainPageTemplate}">
    <Grid SafeAreaEdges="None"
          Padding="0,10,0,0"
          BackgroundColor="Transparent">

        <!-- ОСНОВНОЙ КОНТЕНТ -->
        <sho:ViewSwitcher
            x:Name="Switcher"
            Animate="True"
            SelectedIndex="{Binding SelectedViewModelIndex, Mode=OneWay}">

            <tabsLayout:HomeView BindingContext="{Binding HomePageViewModel}" />
            <tabsLayout:FriendsView BindingContext="{Binding FriendsPageViewModel}" />
        </sho:ViewSwitcher>

        <!--      
        <contentViews:FloatingBottomBarView 
            SelectedIndex="{Binding SelectedViewModelIndex, Mode=TwoWay}"
            TabCommand="{Binding ChangeTabCommand}"
            ZIndex="10" />
           -->

        <Grid VerticalOptions="End"
              HorizontalOptions="Fill"
              Margin="16,0,16,16"
              ZIndex="10"
              RowDefinitions="Auto, Auto">
            <VerticalStackLayout Spacing="10" Grid.Row="0">

                <Border Background="Transparent"
                        StrokeThickness="1"
                        IsVisible="{Binding HasNewUpdate}"
                        HorizontalOptions="CenterAndExpand">
                    
                    <Border.Stroke>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#30FFFFFF" Offset="0.0" />
                            <GradientStop Color="#0CFFFFFF" Offset="0.5" />
                            <GradientStop Color="#108080FF" Offset="1.0" />
                        </LinearGradientBrush>
                    </Border.Stroke>
                    
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,4"
                                Radius="8"
                                Opacity="0.3" />
                    </Border.Shadow>

                    <sho:MaterialFrame
                        MaterialTheme="AcrylicBlur"
                        MaterialBlurStyle="Dark"
                        AndroidBlurRadius="15"
                        CornerRadius="20"
                        Padding="16,10">

                        <Grid ColumnDefinitions="Auto,*,Auto"
                              ColumnSpacing="12"
                              VerticalOptions="Center">

                            <!-- Иконка -->
                            <Image Grid.Column="0"
                                   Source="download_icon.png"
                                   HeightRequest="22"
                                   WidthRequest="22"
                                   VerticalOptions="Center" />

                            <!-- Текст -->
                            <Label Grid.Column="1"
                                   Text="Доступна новая версия"
                                   TextColor="White"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="2" />

                            <!-- Кнопка -->
                            <Button Grid.Column="2"
                                    Text="Скачать"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    TextColor="White"
                                    BackgroundColor="#00CC42"
                                    CornerRadius="12"
                                    HeightRequest="36"
                                    Padding="14,0"
                                    MinimumWidthRequest="90"
                                    Command="{Binding DownloadUpdateCommand}" />

                        </Grid>
                    </sho:MaterialFrame>
                </Border>
                
                <Border StrokeThickness="0"
                        Background="#AA282A37"
                        StrokeShape="RoundRectangle 20"
                        HeightRequest="60">

                    <sho:TabHostView
                        TabType="Fixed"
                        IsSegmented="True"
                        CornerRadius="40"
                        BackgroundColor="Transparent"
                        VerticalOptions="Center"
                        HorizontalOptions="Fill"
                        TouchColor="{StaticResource Primary}"
                        SelectedIndex="{Binding SelectedViewModelIndex, Mode=TwoWay}">

                        <sho:TabHostView.Tabs>
                            <sho:BottomTabItem IconSize="34" IconImageSource="chat_icon.png" />
                            <sho:BottomTabItem IconSize="34" IconImageSource="friends_icon.png" />
                            <sho:BottomTabItem IconSize="34" IconImageSource="call_icon.png" />
                        </sho:TabHostView.Tabs>
                    </sho:TabHostView>
                </Border>

            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>